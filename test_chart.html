<!DOCTYPE html>
<html>
<head>
    <title>Simple Chart Test</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
    <h1>Chart Test</h1>
    <div id="chart" style="width: 800px; height: 600px; background: #000;"></div>

    <script>
        console.log('=== Chart Test Starting ===');

        // Test 1: Check if LightweightCharts is loaded
        if (typeof LightweightCharts !== 'undefined') {
            console.log('✅ LightweightCharts loaded');

            try {
                // Test 2: Create chart
                const chart = LightweightCharts.createChart(document.getElementById('chart'), {
                    width: 800,
                    height: 600,
                    timeScale: { timeVisible: true },
                    grid: { vertLines: { visible: false }, horzLines: { visible: false } }
                });
                console.log('✅ Chart created');

                // Test 3: Add candlestick series
                const candlestickSeries = chart.addCandlestickSeries();
                console.log('✅ Candlestick series added');

                // Test 4: Fetch data from API
                fetch('http://localhost:8003/api/chart/data')
                    .then(response => {
                        console.log('✅ API Response received:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('✅ Data parsed:', data.count, 'candles');

                        if (data.data && data.data.length > 0) {
                            // Test 5: Set data on chart
                            candlestickSeries.setData(data.data);
                            console.log('✅ Chart data set - SUCCESS!');
                        } else {
                            console.error('❌ No data received');
                        }
                    })
                    .catch(error => {
                        console.error('❌ API Error:', error);
                    });

            } catch (error) {
                console.error('❌ Chart creation error:', error);
            }

        } else {
            console.error('❌ LightweightCharts not loaded');
        }
    </script>
</body>
</html>