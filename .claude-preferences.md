# Claude Code Session Preferences

## ğŸ§  **CORE WORKFLOW - Verstehen vor Programmieren**

### **Schritt 1: VollstÃ¤ndiges VerstÃ¤ndnis**
- **NIE sofort programmieren** - erst komplett verstehen
- **Aktiv nachfragen** bis 100% Klarheit erreicht
- **Kontext erfassen**: Was ist das Ziel? Warum? Wie passt es ins Gesamtbild?
- **Edge Cases identifizieren**: Was kÃ¶nnte schiefgehen?
- **Requirements klÃ¤ren**: Alle Unklarheiten beseitigen

### **Schritt 2: Anforderungsanalyse & Design**
- **Ãœber die Anforderungen nachdenken**: Projektstruktur berÃ¼cksichtigen fÃ¼r Ã„nderungen
- **Designpattern evaluieren**: Passende Patterns identifizieren und nutzen
- **Architektur-Entscheidungen**: SOLID Principles und Best Practices anwenden

### **Schritt 3: Intelligenter Ablaufplan**
- **Detaillierten Plan erstellen** mit logischen Schritten
- **Task-AbhÃ¤ngigkeiten analysieren**: Welche Tasks hÃ¤ngen zusammen?
- **Optimierungen identifizieren**: KÃ¶nnen Tasks kombiniert werden?
- **Risiken bewerten**: Welche Schritte sind kritisch?
- **Plan prÃ¤sentieren** und auf "GO" warten

### **Schritt 4: Implementation & Testing**
- **TodoWrite verwenden** fÃ¼r Tracking und Fortschrittskontrolle
- **Schrittweise abarbeiten** nach bestÃ¤tigtem Plan
- **Tests erstellen** fÃ¼r neue FunktionalitÃ¤t wÃ¤hrend Entwicklung
- **Alle Tests ausfÃ¼hren** vor "FERTIG"-Meldung
- **Continuous Validation** - bei Unklarheiten stoppen und nachfragen

## ğŸ”§ Standard Operating Procedures

### Task Management Best Practices
- **IMMER TodoWrite verwenden** fÃ¼r multi-step Tasks
- **Tasks logisch gruppieren** und AbhÃ¤ngigkeiten beachten
- **Granulare Tasks** - lieber mehr kleinere als wenige groÃŸe
- **Tasks sofort als "completed" markieren** nach Fertigstellung
- **Genau EIN Task als "in_progress"** zu jeder Zeit
- **Bei Blockern**: Task pausieren, Problem klÃ¤ren, dann fortfahren

### Code Standards & Best Practices
- **immer Kommentare** hinzufÃ¼gen ohne zu fragen
- **Bestehende Dateien bearbeiten** statt neue erstellen
- **Conventions befolgen** - erst Codebase verstehen, dann anpassen
- **Defensive Programming**: Error Handling, Input Validation
- **DRY Principle**: Don't Repeat Yourself
- **Single Responsibility**: Eine Funktion = Ein Zweck
- **Open/Closed Principle**: Funktionen offen fÃ¼r Erweiterung, geschlossen fÃ¼r Modifikation
- **Readable Code**: Selbstdokumentierender Code Ã¼ber Kommentare
- **Security First**: Nie Secrets/Keys committen
- **Performance Aware**: Efficient algorithms, avoid unnecessary loops

### Software-Architekturen & Design Patterns

#### Erzeugungsmuster (Creational)
- **Factory Pattern**: Objekterstellung abstrahieren
- **Abstract Factory**: Familien verwandter Objekte erstellen
- **Builder Pattern**: Komplexe Objekte schrittweise konstruieren
- **Singleton Pattern**: Genau eine Instanz garantieren

#### Strukturmuster (Structural)
- **Adapter Pattern**: Inkompatible Schnittstellen verbinden
- **Decorator Pattern**: Objekte dynamisch erweitern
- **Facade Pattern**: Vereinfachte Schnittstelle zu komplexen Systemen
- **Composite Pattern**: Baum-Strukturen fÃ¼r Teil-Ganzes-Hierarchien

#### Verhaltensmuster (Behavioral)
- **Observer Pattern**: Event-basierte Kommunikation
- **Strategy Pattern**: Austauschbare Algorithmen/Strategien
- **Command Pattern**: Operationen als Objekte kapseln
- **State Pattern**: Verhalten basierend auf internem Zustand Ã¤ndern
- **Template Method**: Algorithmus-Skelett mit variablen Schritten

#### Architektur-Patterns
- **MVC/MVP/MVVM**: Model-View-Controller Patterns fÃ¼r UI-Trennung
- **Repository Pattern**: Datenabstraktion und -zugriff
- **Dependency Injection**: Lose Kopplung, bessere Testbarkeit
- **SOLID Principles**: Single Responsibility, Open/Closed, Liskov, Interface Segregation, Dependency Inversion
- **Component-Based Architecture**: Modulare, wiederverwendbare Komponenten
- **Layered Architecture**: Separation of Concerns in Schichten
- **Plugin Architecture**: Erweiterbare Systeme durch Plugins

### Response Style & Communication
- **VerstÃ¤ndnis-first**: Fragen bis alles klar ist
- **Strukturierte Antworten**: Plan â†’ BestÃ¤tigung â†’ Implementation
- **Kurz und prÃ¤zise** - max 4 Zeilen auÃŸer bei Details/PlÃ¤nen
- **Deutsche Sprache** bevorzugt fÃ¼r UI-Texte
- **Direkte Antworten** ohne unnÃ¶tige HÃ¶flichkeitsfloskeln
- **Technische Genauigkeit** Ã¼ber Diplomatie
- **Proaktive Probleme identifizieren** statt blind umsetzen

### ğŸš¨ Process Management - CRITICAL RULES

#### 1. **NO STREAMLIT AUTO-START**
- **NIEMALS** Streamlit (Port 8504) ohne explizite Anfrage starten
- **NUR auf direkte Anfrage:** "starte streamlit" oder "start http://localhost:8504"
- **Standard-Projekt-Start** = NUR Chart Server (Port 8003)

#### 2. **Process Cleanup vor jeder Ã„nderung**
```bash
# IMMER vor Ã„nderungen ausfÃ¼hren - verhindert alte Versionen
wmic process where "CommandLine like '%chart_server%'" delete
wmic process where "CommandLine like '%streamlit%'" delete
```

#### 3. **Single Process Policy**
- **NUR EIN** Chart Server zur Zeit
- **Alte Prozesse IMMER killen** vor Neustart
- **Port-Konflikte vermeiden** durch sauberen Cleanup

#### 4. **BUGFIX DOCUMENTATION POLICY**
- **ALLE Bugs ab heute dokumentieren** in `BUGFIX_DOCUMENTATION.md`
- **Format:** Datum, Problem Description, Technical Root Cause, Exact Fix Locations, Prevention Rules
- **Details:** Code-Snippets, Error Messages, Debugging Process, Test Commands
- **Zweck:** ZukÃ¼nftige Sessions kÃ¶nnen identische Bugs sofort lÃ¶sen ohne Neuanalyse

#### Background Tasks
- **Bash parallel calls** fÃ¼r multiple unabhÃ¤ngige Operationen
- **Background Process Monitoring** - regelmÃ¤ÃŸig aufrÃ¤umen

### Project Specifics - RL Trading

#### Standard Asset & Settings
- **NQ=F** als Default-Symbol (NASDAQ-100 Futures)
- **UTC+2 (Europe/Berlin)** Zeitzone
- **5 Tage** historische Daten (period="5d")
- **Lightweight Charts** ohne Gitter (grid: visible: false)

#### Debug Mode Features
- Debug Panel in Sidebar (togglebar)
- Start-Datum Picker (default: 30 Tage zurÃ¼ck)
- Main Controls: Next Kerze, Play/Pause, Speed (0.5x-10x)
- Auto-Play mit geschwindigkeitsabhÃ¤ngigen Delays
- 30 Tage Debug-Daten laden (period="30d")

#### Chart Configuration
```javascript
timeScale: {
    timeVisible: true,
    secondsVisible: false,
    borderColor: '#485c7b'
},
grid: {
    vertLines: { visible: false },
    horzLines: { visible: false }
}
```

## ğŸ“ Key Files - Refactored Structure

### **ğŸ—‚ï¸ Neue Ordnerstruktur**
```
RL-Trading/
â”œâ”€â”€ ğŸ“Š charts/           # Chart Server & Visualisierung
â”‚   â””â”€â”€ chart_server.py  # Haupt-Chart mit Short Position Tool
â”œâ”€â”€ ğŸ“„ static/           # HTML Template Dateien
â”œâ”€â”€ ğŸ”§ scripts/          # JavaScript & Hilfsskripte
â”œâ”€â”€ ğŸ“¦ archive/          # Alte/nicht-benÃ¶tigte Dateien
â”œâ”€â”€ ğŸ§  src/              # RL Trading Core (BEHALTEN)
â”‚   â”œâ”€â”€ app.py           # Main Streamlit App (Port 8504)
â”‚   â”œâ”€â”€ agent.py         # RL Agent Implementation
â”‚   â”œâ”€â”€ env.py           # Trading Environment
â”‚   â”œâ”€â”€ config/settings.py
â”‚   â”œâ”€â”€ components/      # UI Komponenten
â”‚   â”œâ”€â”€ data/            # Datenanbindung
â”‚   â””â”€â”€ services/        # Business Logic
â””â”€â”€ ğŸš€ start_project.py  # Zentraler Projekt-Start
```

### **ğŸ“‹ File Creation Policy - KOMPAKT & SCHLANK**
- **KEINE neuen Dateien im Root** erstellen
- **Neue Dateien gehÃ¶ren in entsprechende Ordner:**
  - Python â†’ `src/` oder `charts/`
  - JavaScript â†’ `scripts/`
  - Tests â†’ `src/tests/`
- **ENTFERNTE Ordner (nicht mehr verwenden):**
  - âŒ `archive/` - KOMPLETT ENTFERNT
  - âŒ `backup_*/` - KOMPLETT ENTFERNT
  - âŒ `static/` - KOMPLETT ENTFERNT
  - âŒ Cache-Ordner werden automatisch regeneriert

### **ğŸ¯ Core Files**
- **ğŸš€ Projekt Start**: `start_project.py` - Zentrale Startup-Datei
- **ğŸ“Š Haupt-Chart**: `charts/chart_server.py` - Mit Short Position Tool
- **ğŸ§  RL Trading App**: `src/app.py` (Port 8504)
- **âš™ï¸ Konfiguration**: `src/config/settings.py`
- **ğŸ“ Ã„nderungshistorie**: `CHANGELOG.md`

## ğŸš€ Quick Commands

### **Standard Project Start - "starte das projekt"**
```bash
# ğŸ¯ EIN BEFEHL fÃ¼r alles - Projekt komplett starten (Server Cleanup + Tests + Start)
./run_tests_and_start.bat
```

### **ğŸ§ª Test Commands - Refactor Testing**
```bash
# Phase 1 Tests - Models Layer
./run_tests_phase1.bat

# Phase 2 Tests - Repositories Layer
./run_tests_phase2.bat

# Alle Unit Tests
./run_tests_unit.bat

# Integration Tests
./run_tests_integration.bat

# ALLE Tests (komplette Suite)
./run_tests_all.bat

# Test Coverage Report (Ã¶ffnet HTML)
./run_tests_coverage.bat

# Manuelle pytest Commands
py -m pytest tests/unit/test_models/ -v          # Nur Models
py -m pytest tests/unit/test_repositories/ -v    # Nur Repositories
py -m pytest tests/integration/ -v               # Nur Integration
py -m pytest tests/ -v --tb=short                # Alle Tests kurz
```

### **Manuelle Starts (Falls nÃ¶tig)**
```bash
# ğŸ“Š Nur Chart-Server (mit Short Position Tool)
py charts/chart_server.py

# ğŸ§  Nur Streamlit RL App
set PYTHONPATH=%cd%\src && py -m streamlit run src/app.py --server.port 8504 --server.headless true

# ğŸ”§ Legacy Start (veraltet - verwende run_tests_and_start.bat)
py start_project.py
```

### Git Operations (wenn gewÃ¼nscht)
```bash
git add .
git commit -m "Feature: [Beschreibung]

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

## ğŸ¯ Session Starter Template

**FÃ¼r neue Sessions kopiere und paste:**

```
CORE WORKFLOW fÃ¼r diese Session:
1. NIE sofort programmieren - erst VOLLSTÃ„NDIG verstehen
2. Aktiv nachfragen bis 100% Klarheit
3. Anforderungsanalyse & Design (Projektstruktur, Designpattern)
4. Intelligenten Ablaufplan erstellen mit Task-AbhÃ¤ngigkeiten
5. Plan zeigen und auf "GO" warten
6. Implementation & Testing mit TodoWrite
7. Tests erstellen fÃ¼r neue FunktionalitÃ¤t
8. Alle Tests starten - nur bei Fehlerfreiheit "FERTIG" abgeben

Standards:
- Best Practices: DRY, Single Responsibility, Open/Closed Principle
- Defensive Programming: Error Handling, Input Validation
- Deutsche UI-Texte, Code-Kommentare immer hinzufÃ¼gen
- NQ=F Standard-Asset, UTC+2 Zeitzone
- HAUPTFENSTER: Chart-Only Port 8003 (./run_tests_and_start.bat)
- Kurze prÃ¤zise Antworten (max 4 Zeilen auÃŸer Details/PlÃ¤ne)
- Testing-First: Tests fÃ¼r jede neue FunktionalitÃ¤t
- CHANGELOG.md aktualisieren bei Ã„nderungen
```

## ğŸ”„ Wiederkehrende Workflows

### Testing & Quality Assurance Workflow
1. **Test-First Development**: Tests als Spezifikation definieren
2. **Parallel Development**: Tests wÃ¤hrend Implementierung erstellen
3. **Funktionelle Tests**: Jede neue FunktionalitÃ¤t einzeln testen
4. **Integration Tests**: Komplette Test-Suite ausfÃ¼hren
5. **QualitÃ¤tskontrolle**: Nur bei Fehlerfreiheit "FERTIG" melden
6. **Dokumentation**: CHANGELOG.md mit allen Ã„nderungen aktualisieren

### Debug Mode Testing
1. Sidebar â†’ "ğŸ› Debug Modus"
2. Start-Datum wÃ¤hlen
3. "â–¶ï¸ Debug Starten"
4. Chart Controls verwenden

### Chart Anpassungen
- Zeitzone: Europe/Berlin
- Grid: visible: false
- TimeScale: timeVisible: true, secondsVisible: false

### Performance
- Background Tasks regelmÃ¤ÃŸig aufrÃ¤umen
- Parallel Bash calls fÃ¼r unabhÃ¤ngige Ops
- Session State effizient nutzen

---
**Erstellt:** 2025-09-17
**FÃ¼r:** RL Trading Projekt
**Zweck:** Konsistente Claude Code Sessions